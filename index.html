<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lixdyrandomstuff ‚ú®</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚≠ê</text></svg>">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tourney:wght@400;700;900&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Lightbox CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css">
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    
    <!-- Browser Image Compression -->
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== TU PALETA ORIGINAL COMPLETA ===== */
        :root {
            --color-jacarta: #3F2A52;
            --color-wisteria: #75619D;
            --color-lavender: #BEAEDB;
            --color-mist: #E6EFF7;
            --color-coffee: #3A2D34;
            
            --bg-start: var(--color-lavender);
            --bg-end: var(--color-mist);
            --bg-container: rgba(255, 255, 255, 0.97);
            --text-primary: var(--color-coffee);
            --text-secondary: #6D5A72;
            --accent-purple: var(--color-jacarta);
            --accent-dark-purple: var(--color-wisteria);
            --hashtag-color: var(--color-wisteria);
            --border-color: var(--color-lavender);
            --shadow: rgba(63, 42, 82, 0.15);
            
            --font-title: 'Tourney', cursive;
            --font-marquee: 'Playfair Display', serif;
            --font-body: 'Georgia', serif;
        }
        
        .dark-mode {
            --bg-start: var(--color-coffee);
            --bg-end: var(--color-jacarta);
            --bg-container: rgba(58, 45, 52, 0.95);
            --text-primary: var(--color-mist);
            --text-secondary: #C9ADA7;
            --accent-purple: var(--color-lavender);
            --accent-dark-purple: var(--color-wisteria);
            --hashtag-color: var(--color-lavender);
            --border-color: var(--color-wisteria);
            --shadow: rgba(190, 174, 219, 0.25);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            color: var(--text-primary);
            font-family: var(--font-body);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* ===== CORAZONCITOS FLOTANTES ===== */
        .floating-heart {
            position: fixed;
            font-size: 24px;
            z-index: -1;
            opacity: 0.4;
            animation: floatHeart 20s infinite linear;
            pointer-events: none;
        }
        
        @keyframes floatHeart {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.4; }
            90% { opacity: 0.4; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        /* ===== DISCO CON BRILLITOS ===== */
        .vinyl-player {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .vinyl-container {
            position: relative;
            width: 120px;
            height: 120px;
            cursor: pointer;
        }
        
        .vinyl-disc {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--color-jacarta), var(--color-wisteria), var(--color-coffee));
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(190, 174, 219, 0.5);
            animation: rotateVinyl 20s linear infinite;
            animation-play-state: paused;
        }
        
        .vinyl-disc.playing {
            animation-play-state: running;
        }
        
        @keyframes rotateVinyl {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .vinyl-label {
            position: absolute;
            top: 30%;
            left: 30%;
            right: 30%;
            bottom: 30%;
            background: linear-gradient(45deg, var(--color-lavender), var(--color-mist));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--color-jacarta);
            font-weight: bold;
        }
        
        .vinyl-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--color-mist);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            z-index: 2;
        }
        
        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: scale(1) rotate(180deg) translateY(-20px); opacity: 0; }
        }
        
        /* ===== BANNER EDITABLE ===== */
        #siteBanner {
            width: 100%;
            max-width: 900px;
            height: 180px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            border: 4px solid var(--accent-purple);
            box-shadow: 0 5px 20px var(--shadow);
            position: relative;
        }
        
        #bannerImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .banner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        #siteBanner:hover .banner-overlay {
            opacity: 1;
        }
        
        /* ===== PERFIL CON FOTO EDITABLE ===== */
        .avatar-container {
            position: relative;
            width: 120px;
            height: 120px;
        }
        
        #avatarImage {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid var(--accent-purple);
            object-fit: cover;
            background: linear-gradient(45deg, var(--color-wisteria), var(--color-lavender));
            cursor: pointer;
        }
        
        .avatar-upload-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--accent-purple);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            z-index: 2;
        }
        
        .avatar-container:hover .avatar-upload-btn {
            display: flex;
        }
        
        /* ===== POSTS CON COLORES ===== */
        .post-item {
            background: var(--post-bg, rgba(255, 255, 255, 0.25));
            padding: 20px;
            margin: 25px 0;
            border-radius: 12px;
            border: 3px solid var(--post-color, var(--accent-purple));
            border-left: 8px solid var(--post-color, var(--accent-purple));
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .post-item:hover {
            transform: translateX(5px);
            box-shadow: 5px 5px 20px var(--shadow);
        }
        
        /* ===== HASHTAGS RESALTADOS ===== */
        .hashtag {
            color: var(--hashtag-color);
            font-weight: bold;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(117, 97, 157, 0.15);
            margin: 0 2px;
            transition: background 0.2s;
            display: inline-block;
        }
        
        .hashtag:hover {
            background: rgba(117, 97, 157, 0.3);
            transform: scale(1.05);
        }
        
        /* ===== SELECTOR DE COLORES ===== */
        .color-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: transform 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border-color: var(--color-mist);
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        /* ===== UPLOAD DE IM√ÅGENES ===== */
        .image-upload-area {
            border: 3px dashed var(--border-color);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 20px;
        }
        
        .image-grid {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }
        
        .single-image { grid-template-columns: 1fr; }
        .two-images { grid-template-columns: 1fr 1fr; }
        .three-images, .four-images { 
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
        }
        
        .post-image {
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid var(--border-color);
            transition: transform 0.3s;
        }
        
        .post-image:hover {
            transform: scale(1.02);
        }
        
        /* ===== COMENTARIOS CON RESPUESTAS ===== */
        .comments-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-color);
            display: none;
        }
        
        .comments-section.active {
            display: block;
        }
        
        .comment.reply {
            margin-left: 40px;
            background: rgba(190, 174, 219, 0.08);
            border-left: 3px solid var(--color-lavender);
            padding: 10px 12px;
            border-radius: 8px;
        }
        
        .reply-form {
            margin-top: 10px;
            padding: 10px;
            background: rgba(63, 42, 82, 0.05);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: none;
        }
        
        .reply-form.active {
            display: block;
        }
        
        /* ===== MODALES ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--bg-container);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 5px solid var(--accent-purple);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            color: var(--color-lavender);
            cursor: pointer;
            background: none;
            border: none;
        }
        
        /* ===== NOTIFICACIONES ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            background: var(--color-wisteria);
            color: white;
            z-index: 9999;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ===== BOTONES ===== */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-family: 'Verdana', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--color-jacarta), var(--color-wisteria));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .site-title { font-size: 2.2em; }
            #siteBanner { height: 150px; }
            .vinyl-player { transform: scale(0.8); bottom: 20px; right: 20px; }
            .comment.reply { margin-left: 20px; }
            .two-images, .three-images, .four-images { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Corazoncitos flotantes -->
    <div id="heartsContainer"></div>

    <!-- Disco con brillitos -->
    <div class="vinyl-player">
        <div class="vinyl-container" onclick="toggleVinyl()">
            <div class="vinyl-disc" id="vinylDisc">
                <div class="vinyl-label">LIX</div>
            </div>
        </div>
        <div class="vinyl-controls" style="background: var(--bg-container); padding: 10px 15px; border-radius: 25px; display: flex; gap: 15px; align-items: center; border: 2px solid var(--border-color);">
            <button onclick="toggleVinyl()" class="vinyl-btn" style="background: none; border: none; color: var(--accent-purple); font-size: 1.5em; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-play" id="playIcon"></i>
            </button>
            <button onclick="createSparkles()" class="vinyl-btn" style="background: none; border: none; color: var(--accent-purple); font-size: 1.5em; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-sparkles"></i>
            </button>
        </div>
        <div class="vinyl-info" style="font-size: 12px; color: var(--text-secondary); text-align: center; max-width: 120px; font-style: italic;">
            üéµ lixdy's vibes ‚Ä¢ click para brillitos ‚ú®
        </div>
    </div>

    <!-- Modal para banner -->
    <div id="bannerModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('bannerModal')">√ó</button>
            <h2 style="color: var(--accent-purple); font-family: var(--font-title); text-align: center;">üñºÔ∏è Cambiar Banner</h2>
            <p style="margin: 15px 0; color: var(--text-secondary); text-align: center;">Sube una imagen (900x180px recomendado)</p>
            <input type="file" id="bannerUpload" accept="image/*" style="display: none;">
            <button onclick="document.getElementById('bannerUpload').click()" class="btn btn-primary" style="width: 100%; margin: 15px 0;">üìÅ Elegir Imagen</button>
            <div id="bannerPreview" style="margin: 20px 0; text-align: center;"></div>
            <button onclick="saveBanner()" class="btn btn-primary" style="width: 100%;">üíæ Guardar Banner</button>
        </div>
    </div>

    <!-- Modal para avatar -->
    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('avatarModal')">√ó</button>
            <h2 style="color: var(--accent-purple); font-family: var(--font-title); text-align: center;">üì∏ Cambiar Foto</h2>
            <p style="margin: 15px 0; color: var(--text-secondary); text-align: center;">Sube una foto cuadrada (300x300px)</p>
            <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
            <button onclick="document.getElementById('avatarUpload').click()" class="btn btn-primary" style="width: 100%; margin: 15px 0;">üìÅ Elegir Foto</button>
            <div id="avatarPreview" style="margin: 20px 0; text-align: center;"></div>
            <button onclick="saveAvatar()" class="btn btn-primary" style="width: 100%;">üíæ Guardar Foto</button>
        </div>
    </div>

    <!-- Modal login -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('loginModal')">√ó</button>
            <h2 style="color: var(--accent-purple); font-family: var(--font-title); text-align: center;">üîê Acceso Owner</h2>
            <input type="email" id="ownerEmail" placeholder="Tu email" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-container); color: var(--text-primary); margin-bottom: 15px;">
            <input type="password" id="ownerPassword" placeholder="Contrase√±a" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-container); color: var(--text-primary);">
            <button onclick="loginOwner()" class="btn btn-primary" style="width: 100%; margin-top: 15px;">‚ú® Iniciar Sesi√≥n</button>
        </div>
    </div>

    <!-- Banner -->
    <div id="siteBanner">
        <img id="bannerImage" class="banner-image" alt="Banner de lixdy" src="https://via.placeholder.com/900x180/3F2A52/BEAEDB?text=‚ú®lixdyrandomstuff‚ú®">
        <div class="banner-overlay">
            <button onclick="openBannerModal()" class="btn btn-primary" id="editBannerBtn" style="display: none;">
                <i class="fas fa-edit"></i> Cambiar Banner
            </button>
        </div>
    </div>

    <!-- Controles -->
    <div class="top-controls" style="max-width: 900px; margin: 0 auto 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <div class="visitor-counter" style="background: var(--accent-purple); color: white; padding: 8px 15px; border-radius: 20px; font-family: 'Courier New', monospace; font-weight: bold;">
            üëÅÔ∏è Visitante #<span id="counter">0000</span>
        </div>
        
        <div class="theme-toggle" onclick="toggleTheme()" style="display: flex; align-items: center; gap: 8px; background: var(--bg-container); padding: 8px 15px; border-radius: 20px; border: 2px solid var(--border-color); cursor: pointer;">
            <div class="toggle-switch" style="width: 40px; height: 20px; background: var(--accent-purple); border-radius: 10px; position: relative;">
                <div id="toggleCircle" style="position: absolute; width: 16px; height: 16px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: transform 0.3s;"></div>
            </div>
            <span id="themeText">Modo Oscuro</span>
        </div>
        
        <button onclick="showLoginModal()" class="btn" style="background: var(--text-secondary); color: white;" id="loginBtn">
            üîì Iniciar Sesi√≥n
        </button>
    </div>

    <!-- Marquee -->
    <div style="max-width: 900px; margin: 0 auto 25px; overflow: hidden; border-radius: 8px;">
        <div style="background: linear-gradient(90deg, var(--color-jacarta), var(--color-wisteria), var(--color-jacarta)); color: white; padding: 12px; font-family: var(--font-marquee); font-size: 16px; border-radius: 8px;">
            <div style="display: inline-block; white-space: nowrap; animation: marqueeScroll 30s linear infinite; padding-left: 100%;">
                („Å• ·¥ó _·¥ó)„Å•‚ô° ¬°BIENVENIDO A EL LUGAR DE MIS PENSAMIENTOS! - ( Àò ¬≥Àò)‚ô• sientete libre de comentar y dar like
            </div>
        </div>
    </div>

    <!-- Contenedor principal -->
    <div style="background: var(--bg-container); border: 6px double var(--accent-purple); padding: 25px; margin: 0 auto; max-width: 900px; border-radius: 15px; box-shadow: 0 0 30px var(--shadow);">
        
        <h1 class="site-title" style="font-family: var(--font-title); font-size: 3em; text-align: center; margin: 20px 0; color: var(--accent-purple);">
            lixdyrandomstuff
        </h1>
        
        <!-- Panel admin -->
        <div id="adminPanel" style="background: linear-gradient(135deg, var(--color-jacarta), var(--color-wisteria)); color: white; padding: 15px; border-radius: 10px; margin-bottom: 25px; display: none; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
            <div>üéÆ <strong>MODO OWNER ACTIVADO</strong> - ¬°Hola lixdy!</div>
            <button onclick="logout()" class="btn" style="background: var(--color-wisteria); color: white;">üîì Cerrar Sesi√≥n</button>
        </div>
        
        <!-- Perfil -->
        <div class="profile-section" style="display: flex; gap: 20px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid var(--accent-purple); flex-wrap: wrap; align-items: center;">
            <div class="avatar-container">
                <img id="avatarImage" class="avatar" alt="Avatar de lixdy" src="https://via.placeholder.com/300/75619D/FFFFFF?text=LIXDY">
                <button class="avatar-upload-btn" onclick="openAvatarModal()" title="Cambiar foto">
                    <i class="fas fa-camera"></i>
                </button>
            </div>
            
            <div style="flex: 1; min-width: 200px;">
                <div style="font-family: var(--font-title); font-size: 2em; color: var(--accent-purple); margin-bottom: 5px;">
                    <span id="profileName">lixdy</span>
                </div>
                
                <div id="profileBio" style="color: var(--text-secondary); margin-top: 10px; line-height: 1.5; padding: 10px; background: rgba(117, 97, 157, 0.08); border-radius: 8px;">
                    random stuff pq soy un poco weirdo <span class="hashtag">#lixdy</span> <span class="hashtag">#random</span> <span class="hashtag">#weirdo</span>
                </div>
                
                <div style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
                    <div style="text-align: center; padding: 8px 15px; background: rgba(63, 42, 82, 0.1); border-radius: 10px; border: 1px solid var(--border-color);">
                        <div style="font-family: var(--font-title); font-size: 1.5em; color: var(--color-wisteria); font-weight: bold;" id="statPosts">0</div>
                        <div>Posts</div>
                    </div>
                    <div style="text-align: center; padding: 8px 15px; background: rgba(63, 42, 82, 0.1); border-radius: 10px; border: 1px solid var(--border-color);">
                        <div style="font-family: var(--font-title); font-size: 1.5em; color: var(--color-wisteria); font-weight: bold;" id="statComments">0</div>
                        <div>Comentarios</div>
                    </div>
                    <div style="text-align: center; padding: 8px 15px; background: rgba(63, 42, 82, 0.1); border-radius: 10px; border: 1px solid var(--border-color);">
                        <div style="font-family: var(--font-title); font-size: 1.5em; color: var(--color-wisteria); font-weight: bold;" id="statLikes">0</div>
                        <div>Estrellitas</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Posts -->
        <div style="margin-top: 30px;">
            <h2 style="color: var(--accent-purple); border-bottom: 3px solid var(--color-wisteria); padding-bottom: 10px; margin-bottom: 20px; font-family: var(--font-title);">
                üìù Mis Publicaciones:
            </h2>
            
            <div id="postsContainer">
                <!-- Posts cargar√°n aqu√≠ -->
            </div>
            
            <!-- Formulario con TODO -->
            <div id="newPostForm" style="display: none; background: rgba(117, 97, 157, 0.08); padding: 25px; border-radius: 12px; border: 2px dashed var(--border-color); margin: 30px 0;">
                <h3 style="color: var(--accent-purple); margin-bottom: 20px;">‚ú® Nueva Publicaci√≥n:</h3>
                <form id="postForm">
                    <input type="text" id="postTitle" placeholder="T√≠tulo (opcional)" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-container); color: var(--text-primary); margin-bottom: 15px;">
                    
                    <textarea id="postContent" placeholder="¬øQu√© quieres compartir hoy? Usa #hashtags para resaltar üåà" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-container); color: var(--text-primary); min-height: 120px; margin-bottom: 20px; resize: vertical;"></textarea>
                    
                    <!-- Selector de colores -->
                    <div style="margin: 15px 0;">
                        <label style="color: var(--accent-purple); font-weight: bold; display: block; margin-bottom: 10px;">üé® Elige un color para tu post:</label>
                        <div class="color-selector" id="colorSelector"></div>
                    </div>
                    
                    <!-- Upload de im√°genes -->
                    <div class="image-upload-area">
                        <label style="display: block; margin-bottom: 15px; color: var(--accent-purple); font-weight: bold;">üñºÔ∏è Subir im√°genes (m√°ximo 4):</label>
                        <input type="file" id="imageInput" multiple accept="image/*" style="display: none;">
                        <button type="button" onclick="document.getElementById('imageInput').click()" class="btn btn-primary">üìÅ Seleccionar Im√°genes</button>
                        <div id="imagePreviews" class="image-grid" style="margin-top: 20px;"></div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button type="submit" class="btn btn-primary">‚ú® Publicar</button>
                        <button type="button" onclick="cancelPost()" class="btn" style="background: var(--text-secondary); color: white;">Cancelar</button>
                    </div>
                </form>
            </div>
            
            <button id="showPostFormBtn" onclick="showPostForm()" class="btn btn-primary" style="display: none; margin: 30px auto; width: 100%; max-width: 300px;">
                üìù Crear Nueva Publicaci√≥n
            </button>
            
            <div id="visitorMessage" style="text-align: center; padding: 40px; color: var(--accent-purple);">
                <p style="font-size: 1.3em; margin-bottom: 15px;">üíú <strong>Soy lixdy, la owner de este espacio.</strong></p>
                <p>Yo publico el contenido principal, ¬°pero t√∫ puedes comentar y dar estrellitas! ‚≠ê</p>
            </div>
        </div>
        
        <!-- Comentarios -->
        <div style="margin-top: 40px; padding-top: 25px; border-top: 3px solid var(--accent-purple);">
            <h2 style="color: var(--accent-purple); margin-bottom: 20px; font-family: var(--font-title);">üí¨ Comentarios:</h2>
            
            <div style="background: rgba(63, 42, 82, 0.08); padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                <input type="text" id="commenterName" placeholder="Tu nombre o apodo" value="" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-container); color: var(--text-primary); margin-bottom: 15px;">
                <textarea id="commentText" placeholder="Escribe tu comentario aqu√≠..." style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-container); color: var(--text-primary); min-height: 80px; margin-bottom: 15px; resize: vertical;"></textarea>
                <button onclick="addComment()" class="btn btn-primary">üí¨ Enviar Comentario</button>
            </div>
            
            <div id="commentsContainer" style="max-height: 500px; overflow-y: auto; padding-right: 10px;"></div>
        </div>
        
        <!-- Footer -->
        <div style="text-align: center; margin-top: 50px; padding-top: 25px; color: var(--text-secondary); font-size: 14px; border-top: 2px dashed var(--border-color);">
            <p><span style="color: var(--accent-purple);">‚≠ê</span> lixdyrandomstuff ¬© 2026 ‚Ä¢ Hecho con üíú <span style="color: var(--accent-purple);">‚≠ê</span></p>
        </div>
    </div>

    <!-- Lightbox JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox-plus-jquery.min.js"></script>
    
    <script>
        // ===== CONFIGURACI√ìN =====
        const SUPABASE_URL = 'https://pfwzdislewisgcuoyiny.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_tyi-ak1lHgP3heMQuFcp4Q_LradvV9z';
        const OWNER_EMAIL = 'alexxa.svelasquez26@gmail.com';
        const OWNER_PASSWORD = '7010458714As.';
        
        // ===== COLORES PARA POSTS =====
        const POST_COLORS = [
            '#3F2A52', '#75619D', '#BEAEDB', '#E6EFF7', '#3A2D34',
            '#5A3D6E', '#8A74B5', '#D4C5E8', '#F5F9FF', '#4E3A3A',
            '#2D524A', '#6D8B74', '#9C7A97', '#C9ADA7', '#2A3D52'
        ];
        
        // ===== VARIABLES =====
        let supabase = null;
        let isOwnerLoggedIn = false;
        let currentTheme = localStorage.getItem('theme') || 'light';
        let vinylPlaying = localStorage.getItem('vinylPlaying') === 'true';
        let selectedColor = POST_COLORS[0];
        let selectedImages = [];
        let selectedBannerFile = null;
        let selectedAvatarFile = null;
        let isPosting = false; // üî• EVITA DUPLICADOS
        
        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Iniciando lixdyrandomstuff...');
            
            try {
                // 1. Inicializar Supabase
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // 2. Aplicar tema
                applyTheme(currentTheme);
                
                // 3. Inicializar selector de colores
                initColorSelector();
                
                // 4. Configurar disco
                initVinylPlayer();
                
                // 5. Verificar autenticaci√≥n
                await checkAuth();
                
                // 6. Cargar datos
                await Promise.all([
                    loadPosts(),
                    loadComments()
                ]);
                
                // 7. Actualizar UI
                updateVisitorCounter();
                updateStats();
                createFloatingHearts();
                
                // 8. Cargar im√°genes guardadas
                loadSavedImages();
                
                // 9. Configurar eventos
                setupEventListeners();
                
                console.log('üéâ ¬°P√°gina lista!');
                showNotification('¬°Bienvenid@ a lixdyrandomstuff! ‚ú®', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error cargando la p√°gina', 'error');
            }
        });
        
        // ===== TEMA =====
        function applyTheme(theme) {
            const body = document.body;
            const toggleCircle = document.getElementById('toggleCircle');
            const themeText = document.getElementById('themeText');
            
            if (theme === 'dark') {
                body.classList.add('dark-mode');
                toggleCircle.style.transform = 'translateX(20px)';
                themeText.textContent = 'Modo Claro';
            } else {
                body.classList.remove('dark-mode');
                toggleCircle.style.transform = 'translateX(2px)';
                themeText.textContent = 'Modo Oscuro';
            }
            localStorage.setItem('theme', theme);
        }
        
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(currentTheme);
            createFloatingHearts();
            showNotification(`Modo ${currentTheme === 'dark' ? 'oscuro' : 'claro'} activado üåô`, 'info');
        }
        
        // ===== DISCO Y BRILLITOS =====
        function initVinylPlayer() {
            const vinylDisc = document.getElementById('vinylDisc');
            const playIcon = document.getElementById('playIcon');
            
            if (vinylPlaying) {
                vinylDisc.classList.add('playing');
                playIcon.className = 'fas fa-pause';
            }
        }
        
        function toggleVinyl() {
            const vinylDisc = document.getElementById('vinylDisc');
            const playIcon = document.getElementById('playIcon');
            
            vinylPlaying = !vinylPlaying;
            localStorage.setItem('vinylPlaying', vinylPlaying);
            
            if (vinylPlaying) {
                vinylDisc.classList.add('playing');
                playIcon.className = 'fas fa-pause';
                createSparkles();
                showNotification('üéµ Disco girando... ¬°Brillitos activados! ‚ú®', 'info');
            } else {
                vinylDisc.classList.remove('playing');
                playIcon.className = 'fas fa-play';
                showNotification('‚è∏Ô∏è Disco pausado', 'info');
            }
        }
        
        function createSparkles() {
            const vinylContainer = document.querySelector('.vinyl-container');
            const colors = ['#FFD700', '#FF6B8B', '#6B8BFF', '#8BFF6B', '#C896FF'];
            
            for (let i = 0; i < 12; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'vinyl-sparkle';
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 70 + Math.random() * 30;
                const x = 60 + Math.cos(angle) * distance;
                const y = 60 + Math.sin(angle) * distance;
                
                sparkle.style.left = x + 'px';
                sparkle.style.top = y + 'px';
                sparkle.style.background = colors[Math.floor(Math.random() * colors.length)];
                sparkle.style.animation = `sparkle ${0.8 + Math.random() * 0.7}s ease-out forwards`;
                sparkle.style.animationDelay = (Math.random() * 0.3) + 's';
                
                vinylContainer.appendChild(sparkle);
                
                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 1500);
            }
        }
        
        // ===== SELECTOR DE COLORES =====
        function initColorSelector() {
            const selector = document.getElementById('colorSelector');
            if (!selector) return;
            
            selector.innerHTML = '';
            
            POST_COLORS.forEach((color, index) => {
                const colorDiv = document.createElement('div');
                colorDiv.className = `color-option ${index === 0 ? 'selected' : ''}`;
                colorDiv.style.backgroundColor = color;
                colorDiv.title = `Color ${index + 1}`;
                colorDiv.onclick = () => selectColor(color, colorDiv);
                selector.appendChild(colorDiv);
            });
        }
        
        function selectColor(color, element) {
            selectedColor = color;
            
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            element.classList.add('selected');
        }
        
        // ===== HASHTAGS RESALTADOS =====
        function processHashtags(text) {
            if (!text) return text;
            return text.replace(/#(\w+)/g, 
                '<span class="hashtag" onclick="filterByHashtag(\'$1\')">#$1</span>'
            );
        }
        
        function filterByHashtag(tag) {
            showNotification(`Hashtag #${tag} seleccionado`, 'info');
            // Aqu√≠ podr√≠as filtrar posts por hashtag
        }
        
        // ===== UPLOAD DE IM√ÅGENES =====
        function setupEventListeners() {
            // Input de im√°genes para posts
            const imageInput = document.getElementById('imageInput');
            if (imageInput) {
                imageInput.addEventListener('change', handleImageSelect);
            }
            
            // Formulario de post
            const postForm = document.getElementById('postForm');
            if (postForm) {
                postForm.addEventListener('submit', handlePostSubmit);
            }
            
            // Inputs para banner/avatar
            document.getElementById('bannerUpload')?.addEventListener('change', function(e) {
                handleFileSelect(e, 'bannerPreview', 5);
            });
            
            document.getElementById('avatarUpload')?.addEventListener('change', function(e) {
                handleFileSelect(e, 'avatarPreview', 2);
            });
        }
        
        function handleImageSelect(event) {
            const files = Array.from(event.target.files).slice(0, 4);
            if (files.length === 0) return;
            
            // Validar tama√±o
            for (const file of files) {
                if (file.size > 2 * 1024 * 1024) {
                    showNotification(`"${file.name}" es muy grande (>2MB)`, 'error');
                    return;
                }
            }
            
            // Mostrar previews
            const previewsContainer = document.getElementById('imagePreviews');
            previewsContainer.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.style.position = 'relative';
                    div.innerHTML = `
                        <img src="${e.target.result}" style="width: 100%; border-radius: 6px;">
                        <button onclick="removeImage(${i})" style="position: absolute; top: 5px; right: 5px; background: var(--color-wisteria); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 14px;">√ó</button>
                    `;
                    previewsContainer.appendChild(div);
                };
                
                reader.readAsDataURL(file);
            }
            
            selectedImages = files;
            
            // Aplicar clase de grid
            const gridClasses = ['single-image', 'two-images', 'three-images', 'four-images'];
            previewsContainer.className = `image-grid ${gridClasses[files.length - 1] || 'four-images'}`;
        }
        
        function handleFileSelect(event, previewId, maxSizeMB) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > maxSizeMB * 1024 * 1024) {
                showNotification(`La imagen es muy grande (>${maxSizeMB}MB)`, 'error');
                return;
            }
            
            if (previewId === 'bannerPreview') {
                selectedBannerFile = file;
            } else {
                selectedAvatarFile = file;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById(previewId);
                if (previewId === 'avatarPreview') {
                    preview.innerHTML = `<img src="${e.target.result}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; border: 4px solid var(--accent-purple);">`;
                } else {
                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 10px;">`;
                }
            };
            reader.readAsDataURL(file);
        }
        
        function removeImage(index) {
            selectedImages.splice(index, 1);
            handleImageSelect({ target: { files: selectedImages } });
        }
        
        // ===== EDITAR FOTO/BANNER =====
        function openBannerModal() {
            if (!isOwnerLoggedIn) {
                showNotification('Inicia sesi√≥n para cambiar el banner', 'error');
                return;
            }
            document.getElementById('bannerModal').style.display = 'flex';
        }
        
        function openAvatarModal() {
            if (!isOwnerLoggedIn) {
                showNotification('Inicia sesi√≥n para cambiar tu foto', 'error');
                return;
            }
            document.getElementById('avatarModal').style.display = 'flex';
        }
        
        function saveBanner() {
            if (!selectedBannerFile) {
                showNotification('Elige una imagen primero', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const bannerImage = document.getElementById('bannerImage');
                bannerImage.src = e.target.result;
                localStorage.setItem('customBanner', e.target.result);
                
                closeModal('bannerModal');
                showNotification('¬°Banner actualizado! üñºÔ∏è', 'success');
                selectedBannerFile = null;
                document.getElementById('bannerPreview').innerHTML = '';
            };
            reader.readAsDataURL(selectedBannerFile);
        }
        
        function saveAvatar() {
            if (!selectedAvatarFile) {
                showNotification('Elige una foto primero', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const avatarImage = document.getElementById('avatarImage');
                avatarImage.src = e.target.result;
                localStorage.setItem('customAvatar', e.target.result);
                
                closeModal('avatarModal');
                showNotification('¬°Foto actualizada! üì∏', 'success');
                selectedAvatarFile = null;
                document.getElementById('avatarPreview').innerHTML = '';
            };
            reader.readAsDataURL(selectedAvatarFile);
        }
        
        function loadSavedImages() {
            const savedBanner = localStorage.getItem('customBanner');
            const savedAvatar = localStorage.getItem('customAvatar');
            
            if (savedBanner) {
                document.getElementById('bannerImage').src = savedBanner;
            }
            if (savedAvatar) {
                document.getElementById('avatarImage').src = savedAvatar;
            }
        }
        
        // ===== AUTENTICACI√ìN =====
        async function checkAuth() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                isOwnerLoggedIn = !!(user && user.email === OWNER_EMAIL);
                updateUIForOwner();
            } catch (error) {
                isOwnerLoggedIn = false;
            }
        }
        
        function updateUIForOwner() {
            const adminPanel = document.getElementById('adminPanel');
            const showPostBtn = document.getElementById('showPostFormBtn');
            const editBannerBtn = document.getElementById('editBannerBtn');
            const loginBtn = document.getElementById('loginBtn');
            const visitorMessage = document.getElementById('visitorMessage');
            
            if (isOwnerLoggedIn) {
                adminPanel.style.display = 'flex';
                showPostBtn.style.display = 'block';
                editBannerBtn.style.display = 'inline-flex';
                loginBtn.style.display = 'none';
                if (visitorMessage) visitorMessage.style.display = 'none';
            } else {
                adminPanel.style.display = 'none';
                showPostBtn.style.display = 'none';
                editBannerBtn.style.display = 'none';
                loginBtn.style.display = 'inline-flex';
                if (visitorMessage) visitorMessage.style.display = 'block';
            }
        }
        
        async function loginOwner() {
            const email = document.getElementById('ownerEmail').value || OWNER_EMAIL;
            const password = document.getElementById('ownerPassword').value || OWNER_PASSWORD;
            
            try {
                const { error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) {
                    // Crear cuenta si no existe
                    const { error: signUpError } = await supabase.auth.signUp({
                        email: email,
                        password: password
                    });
                    
                    if (signUpError) {
                        showNotification('Error: ' + signUpError.message, 'error');
                        return;
                    }
                    
                    showNotification('Cuenta creada. Ahora inicia sesi√≥n.', 'success');
                    return;
                }
                
                isOwnerLoggedIn = true;
                updateUIForOwner();
                closeModal('loginModal');
                showNotification('¬°Bienvenida lixdy! üíú', 'success');
                
                await loadPosts();
                
            } catch (error) {
                showNotification('Error inesperado', 'error');
            }
        }
        
        async function logout() {
            try {
                await supabase.auth.signOut();
                isOwnerLoggedIn = false;
                updateUIForOwner();
                showNotification('Sesi√≥n cerrada', 'info');
                await loadPosts();
            } catch (error) {
                showNotification('Error cerrando sesi√≥n', 'error');
            }
        }
        
        // ===== POSTS (SIN DUPLICADOS) =====
        async function loadPosts() {
            try {
                const { data: posts, error } = await supabase
                    .from('posts')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const container = document.getElementById('postsContainer');
                container.innerHTML = '';
                
                if (!posts || posts.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 60px; color: var(--text-secondary);">
                            <p style="font-size: 1.3em;">üìù A√∫n no hay publicaciones</p>
                            <p>¬°S√© la primera en compartir algo!</p>
                        </div>
                    `;
                    return;
                }
                
                // Usar Set para evitar duplicados
                const seenIds = new Set();
                
                for (const post of posts) {
                    if (seenIds.has(post.id)) continue;
                    seenIds.add(post.id);
                    
                    const postElement = createPostElement(post);
                    if (postElement) {
                        container.appendChild(postElement);
                    }
                }
                
                // Inicializar lightbox
                if (window.lightbox) {
                    lightbox.option({
                        'resizeDuration': 200,
                        'wrapAround': true
                    });
                }
                
            } catch (error) {
                console.error('Error cargando posts:', error);
                showNotification('Error cargando posts', 'error');
            }
        }
        
        function createPostElement(post) {
            try {
                const div = document.createElement('div');
                div.className = 'post-item';
                div.id = `post-${post.id}`;
                
                // Aplicar color
                const postColor = post.color || POST_COLORS[Math.floor(Math.random() * 5)];
                div.style.setProperty('--post-bg', lightenColor(postColor, 70));
                div.style.setProperty('--post-color', postColor);
                
                // Grid de im√°genes
                let gridClass = 'single-image';
                let imagesHTML = '';
                if (post.images && post.images.length > 0) {
                    const gridClasses = ['single-image', 'two-images', 'three-images', 'four-images'];
                    gridClass = gridClasses[Math.min(post.images.length, 4) - 1];
                    
                    imagesHTML = `<div class="image-grid ${gridClass}" style="margin: 20px 0;">`;
                    post.images.forEach((img, index) => {
                        imagesHTML += `
                            <a href="${img}" data-lightbox="post-${post.id}" data-title="${post.title || 'Imagen'}">
                                <img src="${img}" class="post-image" alt="Imagen ${index + 1}">
                            </a>
                        `;
                    });
                    imagesHTML += '</div>';
                }
                
                // Contenido con hashtags procesados
                const contentHTML = processHashtags(post.content || '');
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                        <h3 style="font-family: var(--font-title); color: var(--accent-purple); margin: 0;">${post.title || 'Publicaci√≥n'}</h3>
                        <div style="color: var(--text-secondary); font-size: 0.9em; font-style: italic; background: rgba(255, 255, 255, 0.15); padding: 4px 8px; border-radius: 12px;">
                            ${new Date(post.created_at).toLocaleDateString('es-ES', { 
                                weekday: 'long', 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </div>
                    </div>
                    
                    <div style="white-space: pre-wrap; margin-bottom: 20px; line-height: 1.6;">${contentHTML}</div>
                    
                    ${imagesHTML}
                    
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--border-color);">
                        <button onclick="toggleLike(${post.id})" style="background: none; border: none; font-size: 1.8em; cursor: pointer; padding: 5px; transition: transform 0.2s;" id="likeBtn-${post.id}">
                            ‚òÜ
                        </button>
                        <span style="font-family: var(--font-title); font-size: 1.3em; color: var(--color-wisteria); font-weight: bold;" id="likeCount-${post.id}">${post.likes || 0}</span>
                        
                        <button onclick="toggleComments(${post.id})" style="background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 5px 10px; border-radius: 15px; display: flex; align-items: center; gap: 5px; transition: background 0.2s;">
                            <i class="fas fa-comment"></i>
                            <span id="commentCount-${post.id}">${post.comments_count || 0}</span>
                        </button>
                    </div>
                    
                    <div class="comments-section" id="comments-${post.id}">
                        <div style="background: rgba(63, 42, 82, 0.08); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <input type="text" id="commenterName-${post.id}" placeholder="Tu nombre" value="${localStorage.getItem('commenterName') || ''}" style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px; margin-bottom: 10px;">
                            <textarea id="commentText-${post.id}" placeholder="Escribe un comentario..." rows="2" style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px;"></textarea>
                            <button onclick="addCommentToPost(${post.id})" class="btn btn-primary" style="margin-top: 10px; padding: 8px 15px;">üí¨ Comentar</button>
                        </div>
                        
                        <div id="commentsContainer-${post.id}"></div>
                    </div>
                `;
                
                return div;
            } catch (error) {
                console.error('Error creando post:', error);
                return null;
            }
        }
        
        function lightenColor(color, percent) {
            try {
                const num = parseInt(color.replace('#', ''), 16);
                const amt = Math.round(2.55 * percent);
                const R = Math.min(255, (num >> 16) + amt);
                const G = Math.min(255, (num >> 8 & 0x00FF) + amt);
                const B = Math.min(255, (num & 0x0000FF) + amt);
                return `rgb(${R}, ${G}, ${B})`;
            } catch (e) {
                return 'rgb(255, 255, 255)';
            }
        }
        
        // üî• ARREGLADO: EVITA POSTS DUPLICADOS
        async function handlePostSubmit(event) {
            event.preventDefault();
            
            if (isPosting) {
                showNotification('Ya est√°s publicando, espera...', 'error');
                return;
            }
            
            if (!isOwnerLoggedIn) {
                showNotification('Inicia sesi√≥n para publicar', 'error');
                return;
            }
            
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            
            if (!content) {
                showNotification('¬°Escribe algo!', 'error');
                return;
            }
            
            isPosting = true; // üîí BLOQUEA DUPLICADOS
            
            try {
                showNotification('Publicando... ‚ú®', 'info');
                
                // Extraer hashtags
                const hashtags = content.match(/#(\w+)/g) || [];
                
                // Crear post con color
                const postData = {
                    title: title || null,
                    content: content,
                    content_html: processHashtags(content),
                    hashtags: hashtags.map(tag => tag.toLowerCase()),
                    likes: 0,
                    comments_count: 0,
                    created_at: new Date().toISOString(),
                    owner_id: 'lixdy',
                    color: selectedColor
                };
                
                // Insertar post
                const { error } = await supabase
                    .from('posts')
                    .insert([postData]);
                
                if (error) {
                    // Si falla por columnas extras, intentar simple
                    const postDataSimple = {
                        title: title || null,
                        content: content,
                        likes: 0,
                        comments_count: 0,
                        created_at: new Date().toISOString(),
                        owner_id: 'lixdy'
                    };
                    
                    const { error: errorSimple } = await supabase
                        .from('posts')
                        .insert([postDataSimple]);
                    
                    if (errorSimple) throw errorSimple;
                }
                
                // √âxito
                cancelPost();
                await loadPosts();
                updateStats();
                showNotification('¬°Publicado con √©xito! ‚ú®', 'success');
                
                // Brillitos para celebrar
                if (vinylPlaying) {
                    createSparkles();
                }
                
            } catch (error) {
                console.error('Error publicando:', error);
                showNotification('Error: ' + error.message, 'error');
            } finally {
                isPosting = false; // üîì DESBLOQUEA
            }
        }
        
        // ===== COMENTARIOS Y RESPUESTAS =====
        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            commentsSection.classList.toggle('active');
            
            if (commentsSection.classList.contains('active')) {
                loadCommentsForPost(postId);
            }
        }
        
        async function loadCommentsForPost(postId) {
            try {
                const { data: comments, error } = await supabase
                    .from('comments')
                    .select('*')
                    .eq('post_id', postId)
                    .order('created_at', { ascending: true });
                
                if (error) throw error;
                
                const container = document.getElementById(`commentsContainer-${postId}`);
                container.innerHTML = '';
                
                if (!comments || comments.length === 0) {
                    container.innerHTML = `<p style="text-align: center; color: var(--text-secondary); padding: 20px;">üí¨ S√© el primero en comentar</p>`;
                    return;
                }
                
                const mainComments = comments.filter(c => !c.parent_id);
                const replies = comments.filter(c => c.parent_id);
                
                for (const comment of mainComments) {
                    const commentElement = createCommentElement(comment);
                    container.appendChild(commentElement);
                    
                    // Agregar respuestas
                    const commentReplies = replies.filter(r => r.parent_id === comment.id);
                    for (const reply of commentReplies) {
                        const replyElement = createCommentElement(reply, true);
                        container.appendChild(replyElement);
                    }
                }
                
            } catch (error) {
                console.error('Error cargando comentarios:', error);
            }
        }
        
        function createCommentElement(comment, isReply = false) {
            const div = document.createElement('div');
            div.className = `comment ${isReply ? 'reply' : ''}`;
            
            const date = new Date(comment.created_at);
            const formattedDate = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + 
                                 ' ¬∑ ' + date.toLocaleDateString('es-ES');
            
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="color: var(--accent-purple); font-weight: bold;">${comment.author_name || 'An√≥nimo'}</span>
                    <span style="color: var(--text-secondary); font-size: 0.8em;">${formattedDate}</span>
                </div>
                <div style="line-height: 1.4; margin-bottom: 8px;">${comment.content || ''}</div>
                ${!isReply ? `
                <div style="display: flex; gap: 10px; margin-top: 8px;">
                    <button onclick="showReplyForm('${comment.id}', '${comment.author_name}')" 
                            style="background: none; border: none; color: var(--text-secondary); cursor: pointer;
                                   padding: 2px 6px; border-radius: 10px; font-size: 0.9em;">
                        <i class="fas fa-reply"></i> Responder
                    </button>
                </div>
                
                <div class="reply-form" id="reply-form-${comment.id}">
                    <textarea id="reply-text-${comment.id}" placeholder="Escribe tu respuesta..." rows="2"
                              style="width: 100%; padding: 8px; border: 2px solid var(--border-color); 
                                     border-radius: 8px; margin-bottom: 8px;"></textarea>
                    <button onclick="submitReply('${comment.id}')" class="btn btn-primary" style="padding: 6px 12px; font-size: 13px; border-radius: 15px;">
                        üí¨ Enviar Respuesta
                    </button>
                    <button onclick="hideReplyForm('${comment.id}')" class="btn" style="background: var(--text-secondary); color: white; padding: 6px 12px; font-size: 13px; border-radius: 15px; margin-left: 8px;">
                        Cancelar
                    </button>
                </div>
                ` : ''}
            `;
            
            return div;
        }
        
        function showReplyForm(commentId, authorName) {
            document.querySelectorAll('.reply-form').forEach(form => {
                form.classList.remove('active');
            });
            
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            if (replyForm) {
                replyForm.classList.add('active');
                replyForm.querySelector('textarea').placeholder = `Respondiendo a ${authorName}...`;
                replyForm.querySelector('textarea').focus();
            }
        }
        
        function hideReplyForm(commentId) {
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            if (replyForm) {
                replyForm.classList.remove('active');
                replyForm.querySelector('textarea').value = '';
            }
        }
        
        async function submitReply(commentId) {
            const replyText = document.getElementById(`reply-text-${commentId}`).value.trim();
            const commenterName = document.getElementById(`commenterName-${commentId}`)?.value.trim() || 
                                 localStorage.getItem('commenterName') || 'An√≥nimo';
            
            if (!replyText) {
                showNotification('¬°Escribe una respuesta!', 'error');
                return;
            }
            
            try {
                // Obtener post_id del comentario padre
                const { data: parentComment } = await supabase
                    .from('comments')
                    .select('post_id')
                    .eq('id', commentId)
                    .single();
                
                if (!parentComment) throw new Error('Comentario no encontrado');
                
                // Insertar respuesta
                const { error } = await supabase
                    .from('comments')
                    .insert([{
                        post_id: parentComment.post_id,
                        parent_id: commentId,
                        author_name: commenterName,
                        content: replyText,
                        created_at: new Date().toISOString()
                    }]);
                
                if (error) throw error;
                
                // Actualizar contador
                const { data: post } = await supabase
                    .from('posts')
                    .select('comments_count')
                    .eq('id', parentComment.post_id)
                    .single();
                
                if (post) {
                    await supabase
                        .from('posts')
                        .update({ comments_count: (post.comments_count || 0) + 1 })
                        .eq('id', parentComment.post_id);
                }
                
                // Limpiar y actualizar
                hideReplyForm(commentId);
                await loadCommentsForPost(parentComment.post_id);
                updateStats();
                
                showNotification('¬°Respuesta enviada! üí¨', 'success');
                
            } catch (error) {
                console.error('Error enviando respuesta:', error);
                showNotification('Error al responder', 'error');
            }
        }
        
        async function addCommentToPost(postId) {
            const nameInput = document.getElementById(`commenterName-${postId}`);
            const textInput = document.getElementById(`commentText-${postId}`);
            
            const name = nameInput?.value.trim() || 'An√≥nimo';
            const text = textInput?.value.trim();
            
            if (!text) {
                showNotification('¬°Escribe un comentario!', 'error');
                return;
            }
            
            try {
                if (nameInput) localStorage.setItem('commenterName', name);
                
                const { error } = await supabase
                    .from('comments')
                    .insert([{
                        post_id: postId,
                        author_name: name,
                        content: text,
                        created_at: new Date().toISOString()
                    }]);
                
                if (error) throw error;
                
                // Actualizar contador
                const { data: post } = await supabase
                    .from('posts')
                    .select('comments_count')
                    .eq('id', postId)
                    .single();
                
                if (post) {
                    await supabase
                        .from('posts')
                        .update({ comments_count: (post.comments_count || 0) + 1 })
                        .eq('id', postId);
                    
                    // Actualizar UI
                    const commentCountElement = document.getElementById(`commentCount-${postId}`);
                    if (commentCountElement) {
                        commentCountElement.textContent = (post.comments_count || 0) + 1;
                    }
                }
                
                if (textInput) textInput.value = '';
                await loadCommentsForPost(postId);
                updateStats();
                
                showNotification('¬°Comentario enviado! üí¨', 'success');
                
            } catch (error) {
                console.error('Error comentando:', error);
                showNotification('Error al comentar', 'error');
            }
        }
        
        // ===== COMENTARIOS GENERALES =====
        async function addComment() {
            const nameInput = document.getElementById('commenterName');
            const textInput = document.getElementById('commentText');
            
            const name = nameInput?.value.trim() || 'An√≥nimo';
            const text = textInput?.value.trim();
            
            if (!text) {
                showNotification('¬°Escribe un comentario!', 'error');
                return;
            }
            
            try {
                if (nameInput) localStorage.setItem('commenterName', name);
                
                const { data: posts } = await supabase
                    .from('posts')
                    .select('id')
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                if (!posts || posts.length === 0) {
                    showNotification('Crea un post primero', 'error');
                    return;
                }
                
                const postId = posts[0].id;
                
                const { error } = await supabase
                    .from('comments')
                    .insert([{
                        post_id: postId,
                        author_name: name,
                        content: text,
                        created_at: new Date().toISOString()
                    }]);
                
                if (error) throw error;
                
                if (textInput) textInput.value = '';
                await loadComments();
                await loadPosts();
                updateStats();
                
                showNotification('¬°Comentario enviado! üí¨', 'success');
                
            } catch (error) {
                console.error('Error comentando:', error);
                showNotification('Error al comentar', 'error');
            }
        }
        
        async function loadComments() {
            try {
                const { data: comments, error } = await supabase
                    .from('comments')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                const container = document.getElementById('commentsContainer');
                container.innerHTML = '';
                
                if (!comments || comments.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                            <p>üí¨ A√∫n no hay comentarios</p>
                        </div>
                    `;
                    return;
                }
                
                for (const comment of comments) {
                    const div = document.createElement('div');
                    div.className = 'comment';
                    const date = new Date(comment.created_at);
                    div.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--accent-purple); font-weight: bold;">${comment.author_name || 'An√≥nimo'}</span>
                            <span style="color: var(--text-secondary); font-size: 0.8em;">
                                ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} ¬∑ ${date.toLocaleDateString('es-ES')}
                            </span>
                        </div>
                        <div>${comment.content || ''}</div>
                    `;
                    container.appendChild(div);
                }
                
            } catch (error) {
                console.error('Error cargando comentarios:', error);
            }
        }
        
        // ===== LIKES =====
        async function toggleLike(postId) {
            try {
                const visitorId = getVisitorId();
                const likeKey = `like_${postId}_${visitorId}`;
                const hasLiked = localStorage.getItem(likeKey) === 'true';
                
                const likeBtn = document.getElementById(`likeBtn-${postId}`);
                const likeCount = document.getElementById(`likeCount-${postId}`);
                const currentLikes = parseInt(likeCount.textContent) || 0;
                
                if (hasLiked) {
                    // Quitar like
                    localStorage.setItem(likeKey, 'false');
                    likeBtn.textContent = '‚òÜ';
                    likeCount.textContent = currentLikes - 1;
                    
                    await supabase
                        .from('posts')
                        .update({ likes: currentLikes - 1 })
                        .eq('id', postId);
                    
                } else {
                    // Dar like
                    localStorage.setItem(likeKey, 'true');
                    likeBtn.textContent = '‚≠ê';
                    likeCount.textContent = currentLikes + 1;
                    
                    // Efecto de estrellitas
                    createStars(likeBtn);
                    
                    await supabase
                        .from('posts')
                        .update({ likes: currentLikes + 1 })
                        .eq('id', postId);
                }
                
                updateStats();
                
            } catch (error) {
                console.error('Error like:', error);
            }
        }
        
        function createStars(element) {
            if (!element) return;
            
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < 6; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.style.cssText = `
                        position: fixed; width: 12px; height: 12px;
                        background: #FFD700; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
                        left: ${centerX}px; top: ${centerY}px; z-index: 9999;
                        pointer-events: none; animation: starFloat 1s forwards;
                    `;
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 30 + Math.random() * 30;
                    star.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                    star.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                    
                    document.body.appendChild(star);
                    setTimeout(() => star.remove(), 1000);
                }, i * 50);
            }
        }
        
        function getVisitorId() {
            let visitorId = localStorage.getItem('visitorId');
            if (!visitorId) {
                visitorId = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('visitorId', visitorId);
            }
            return visitorId;
        }
        
        // ===== ESTAD√çSTICAS =====
        async function updateStats() {
            try {
                const { data: posts } = await supabase.from('posts').select('id, likes, comments_count');
                const { data: comments } = await supabase.from('comments').select('id');
                
                if (posts) {
                    document.getElementById('statPosts').textContent = posts.length;
                    document.getElementById('statLikes').textContent = posts.reduce((sum, post) => sum + (post.likes || 0), 0);
                    document.getElementById('statComments').textContent = comments ? comments.length : 0;
                }
            } catch (error) {
                console.error('Error stats:', error);
            }
        }
        
        function updateVisitorCounter() {
            let count = localStorage.getItem('visitCount') || 0;
            count = parseInt(count) + 1;
            localStorage.setItem('visitCount', count);
            document.getElementById('counter').textContent = count.toString().padStart(4, '0');
        }
        
        // ===== CORAZONCITOS =====
        function createFloatingHearts() {
            const container = document.getElementById('heartsContainer');
            container.innerHTML = '';
            
            const hearts = ['üíú', '‚ù§Ô∏è', 'üíñ', 'üñ§', 'üíó'];
            for (let i = 0; i < 12; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.animationDelay = Math.random() * 15 + 's';
                heart.style.color = currentTheme === 'dark' ? '#C896FF' : '#75619D';
                container.appendChild(heart);
            }
        }
        
        // ===== UTILIDADES =====
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function showPostForm() {
            document.getElementById('newPostForm').style.display = 'block';
            document.getElementById('showPostFormBtn').style.display = 'none';
            initColorSelector();
        }
        
        function cancelPost() {
            document.getElementById('newPostForm').style.display = 'none';
            document.getElementById('showPostFormBtn').style.display = 'block';
            document.getElementById('postForm').reset();
            selectedImages = [];
            document.getElementById('imagePreviews').innerHTML = '';
            selectedColor = POST_COLORS[0];
            initColorSelector();
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.background = type === 'error' ? '#8B5A6D' : 
                                          type === 'success' ? '#75619D' : '#3F2A52';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // CSS para animaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes marqueeScroll {
                0% { transform: translateX(0); }
                100% { transform: translateX(-100%); }
            }
            @keyframes starFloat {
                0% { transform: translate(0, 0) scale(0); opacity: 1; }
                100% { transform: translate(var(--tx, 0), var(--ty, 0)) scale(1); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

